<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper
	namespace="com.dkitec.barocle.admin.repairBikeMall.manageMall.service.ManageMallMapper">

	<select id="getRepairPartPriceList" parameterType="ManageMallVo"
		resultType="ManageMallVo">
		SELECT /* 바로클포 수리단가 관리 조회 */
		PRI.REPAIR_OURSRC_PRICE_SEQ AS repairOursrcPriceSeq
		, PRI.COM_CD AS comCd
		, COM.MLANG_COM_CD_NAME AS partName
		, PRI.PRICE_YMD AS priceYmd
		, PRI.PRICE AS price
		, PRI.REG_DTTM AS regDttm
		FROM TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRI
		LEFT
		JOIN TB_SYS_MLANG_COM_CD COM ON PRI.COM_CD = COM.COM_CD
		WHERE 1=1
		<if test='comCd != null and comCd != ""'>
			AND PRI.COM_CD = #{comCd}
		</if>
		<if test='priceYmd != null and priceYmd != ""'>
			AND PRI.PRICE_YMD = #{priceYmd}
		</if>
		LIMIT #{firstRecordIndex},#{recordCountPerPage}
	</select>

	<select id="getRepairPartPriceListCount" parameterType="ManageMallVo"
		resultType="int">
		SELECT /* 바로클포 수리단가 관리 count 조회 */
		COUNT(*)
		FROM TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRI
		LEFT JOIN TB_SYS_MLANG_COM_CD
		COM ON PRI.COM_CD = COM.COM_CD
		WHERE 1=1
		<if test='comCd != null and comCd != ""'>
			AND PRI.COM_CD = #{comCd}
		</if>
		<if test='priceYmd != null and priceYmd != ""'>
			AND PRI.PRICE_YMD = #{priceYmd}
		</if>
	</select>

	<insert id="addPartPrice" parameterType="ManageMallVo">
		INSERT INTO
		TB_MTC_REPAIR_OUTSRC_PRICE_HIST(
		COM_CD
		, PRICE_YMD
		, PRICE
		, REG_DTTM
		)
		VALUES (
		#{comCd}
		, #{priceYmd}
		, #{price}
		, NOW()
		)
	</insert>

	<select id="getRepairPartPriceDetl" parameterType="ManageMallVo"
		resultType="ManageMallVo">
		SELECT
		REPAIR_OURSRC_PRICE_SEQ AS repairOursrcPriceSeq
		, COM_CD AS comCd
		, PRICE_YMD AS priceYmd
		, PRICE AS price
		, REG_DTTM AS regDttm
		FROM TB_MTC_REPAIR_OUTSRC_PRICE_HIST
		WHERE
		REPAIR_OURSRC_PRICE_SEQ = #{repairOursrcPriceSeq}
	</select>

	<update id="updatePartPrice" parameterType="ManageMallVo">
		UPDATE
		TB_MTC_REPAIR_OUTSRC_PRICE_HIST
		SET
		PRICE_YMD = #{priceYmd}
		,PRICE = #{price}
		WHERE REPAIR_OURSRC_PRICE_SEQ = #{repairOursrcPriceSeq}
	</update>

	<!-- <select id="getbikeMallReportList" parameterType="RepairTnsBikeVo" 
		resultType="RepairTnsBikeVo"> SELECT /* 바로클포 월 정비 보고서 조회 */ INFO.REG_DTTM 
		AS regDttm , CEN.CENTER_NAME AS centerName , COUNT(DETL.REPAIR_OURSRC_SEQ) 
		AS repairCnt , SUM(PRIC.PRICE) AS totPrice , dg_decrypt('TB_SYS_ADMIN','ADMIN_MPN_NO', 
		ADM.ADMIN_MPN_NO) AS mpnNo , ADM.ADMIN_ID AS adminId , DATE_FORMAT(INFO.REPAIR_END_DTTM, 
		'%Y-%m') AS months FROM TB_MTC_REPAIR_OUTSRC_INFO INFO, TB_MTC_REPAIR_OUTSRC_DETL 
		DETL, TB_MTC_REPAIR_OUTSRC_MAIN MAIN, TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, 
		TB_OPR_CENTER CEN, TB_SYS_ADMIN ADM WHERE INFO.REPAIR_OURSRC_SEQ = DETL.REPAIR_OURSRC_SEQ 
		AND INFO.REPAIR_OUTSRC_MAIN_SEQ = MAIN.REPAIR_OUTSRC_MAIN_SEQ AND DETL.BRKDN_STUS_CD 
		= PRIC.COM_CD AND DETL.REPAIR_YN = 'Y' AND INFO.TAKE_ID = ADM.ADMIN_ID AND 
		ADM.ADMIN_GRP_SEQ = 21 AND ADM.ASSIGN_CENTER_ID = CEN.CENTER_ID AND PRIC.PRICE_YMD 
		= YEAR(INFO.REPAIR_END_DTTM) <if test="searchBgnDe!='' and searchBgnDe!=null"> 
		<![CDATA[AND INFO.REG_DTTM >= STR_TO_DATE(#{searchBgnDe}, '%Y-%m-%d')]]> 
		</if> <if test="searchEndDe!='' and searchEndDe!=null"> <![CDATA[AND INFO.REG_DTTM 
		<= STR_TO_DATE(#{searchEndDe}, '%Y-%m-%d')]]> </if> <if test="centerId !='' 
		and centerId !=null"> AND ADM.ASSIGN_CENTER_ID = #{centerId} </if> <if test="adminId 
		!='' and adminId !=null"> AND ADM.ADMIN_ID = #{adminId} </if> GROUP BY INFO.TAKE_ID, 
		MONTH(INFO.REPAIR_END_DTTM) ORDER BY months DESC LIMIT #{firstRecordIndex},#{recordCountPerPage} 
		</select> -->

	<select id="getbikeMallReportList" parameterType="RepairTnsBikeVo"
		resultType="RepairTnsBikeVo">
		SELECT
		A.regDttm,A.centerName,A.repairCnt,A.totPrice,A.mpnNo,A.adminId,A.months,MAX(NOTICE.SEND_DTTM)
		AS sendDttm
		FROM (
		SELECT /* 바로클포 월 정비 보고서 조회 */
		INFO.REG_DTTM AS regDttm
		, CEN.CENTER_NAME AS centerName
		, SUM( CASE WHEN DETL.BRKDN_STUS_CD = 'REC_001' THEN 0 ELSE 1 END ) AS repairCnt
		, SUM(PRIC.PRICE*DETL.DISCOUNT_RATE) AS totPrice
		<!-- , dg_decrypt('TB_SYS_ADMIN','ADMIN_MPN_NO', ADM.ADMIN_MPN_NO) AS mpnNo -->
		, CAST(AES_DECRYPT(UNHEX(ADM.ADMIN_MPN_NO),'BRC') as CHAR) AS mpnNo
		, ADM.ADMIN_ID AS adminId
		, DATE_FORMAT(INFO.COLLECT_DTTM, '%Y-%m') AS months
		, CEN.CENTER_ID
		FROM TB_MTC_REPAIR_OUTSRC_INFO INFO,
		TB_MTC_REPAIR_OUTSRC_DETL DETL,
		TB_MTC_REPAIR_OUTSRC_MAIN MAIN,
		TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC,
		TB_OPR_CENTER CEN,
		TB_SYS_ADMIN ADM
		WHERE INFO.REPAIR_OURSRC_SEQ = DETL.REPAIR_OURSRC_SEQ
		AND INFO.REPAIR_OUTSRC_MAIN_SEQ = MAIN.REPAIR_OUTSRC_MAIN_SEQ
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND DETL.REPAIR_YN = 'Y'
		AND INFO.TAKE_ID = ADM.ADMIN_ID
		AND ADM.ADMIN_GRP_SEQ = 21
		AND ADM.ASSIGN_CENTER_ID = CEN.CENTER_ID
		AND PRIC.PRICE_YMD = YEAR(INFO.COLLECT_DTTM)
		<if test="searchBgnDe!='' and searchBgnDe!=null">
				AND INFO.COLLECT_DTTM BETWEEN ( LAST_DAY( STR_TO_DATE(#{searchBgnDe}, '%Y-%m-%d') - interval 1 MONTH) + INTERVAL 1 DAY ) AND ( LAST_DAY( STR_TO_DATE(#{searchBgnDe}, '%Y-%m-%d') ) + INTERVAL 1 DAY - INTERVAL 1 SECOND )
		</if>
		<if test='@com.dkitec.barocle.util.webutil.StringUtil@isEmpty(searchBgnDe)'>
			AND INFO.COLLECT_DTTM BETWEEN ( LAST_DAY(NOW() - interval 1 MONTH) + INTERVAL 1 DAY ) AND ( LAST_DAY(NOW()) + INTERVAL 1 DAY  - INTERVAL 1 SECOND )
		</if>
		
		<if test="centerId !='' and centerId !=null">
			AND ADM.ASSIGN_CENTER_ID = #{centerId}
		</if>
		<if test="adminId !='' and adminId !=null">
			AND ADM.ADMIN_ID = #{adminId}
		</if>
		GROUP BY INFO.TAKE_ID, MONTH(INFO.COLLECT_DTTM)
		)A
		LEFT JOIN TB_MTC_REPAIR_NOTICE NOTICE ON A.CENTER_ID = NOTICE.CENTER_ID
		AND NOTICE.SEND_DTTM
		AND NOTICE.MONTHS = A.months
		GROUP BY A.regDttm,
		A.centerName, A.repairCnt, A.totPrice, A.mpnNo, A.adminId,
		A.months,NOTICE.MONTHS
		ORDER BY A.months DESC, centerName
		LIMIT #{firstRecordIndex},#{recordCountPerPage}
	</select>
	
	 

	<select id="getbikeMallReportListCount" parameterType="RepairTnsBikeVo"
		resultType="int">
		SELECT /* 바로클포 월 정비 보고서 count 조회 */
		COUNT(*)
		FROM (
		SELECT 1
		FROM TB_MTC_REPAIR_OUTSRC_INFO INFO,
		TB_MTC_REPAIR_OUTSRC_DETL DETL,
		TB_MTC_REPAIR_OUTSRC_MAIN MAIN,
		TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC,
		TB_OPR_CENTER CEN,
		TB_SYS_ADMIN ADM
		WHERE INFO.REPAIR_OURSRC_SEQ = DETL.REPAIR_OURSRC_SEQ
		AND INFO.REPAIR_OUTSRC_MAIN_SEQ = MAIN.REPAIR_OUTSRC_MAIN_SEQ
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND DETL.REPAIR_YN = 'Y'
		AND INFO.TAKE_ID = ADM.ADMIN_ID
		AND ADM.ADMIN_GRP_SEQ = 21
		AND ADM.ASSIGN_CENTER_ID = CEN.CENTER_ID
		AND PRIC.PRICE_YMD = YEAR(INFO.REPAIR_END_DTTM)
		<if test="searchBgnDe!='' and searchBgnDe!=null">
				AND INFO.COLLECT_DTTM BETWEEN ( LAST_DAY( STR_TO_DATE(#{searchBgnDe}, '%Y-%m-%d') - interval 1 MONTH) + INTERVAL 1 DAY ) AND ( LAST_DAY( STR_TO_DATE(#{searchBgnDe}, '%Y-%m-%d') ) - INTERVAL 1 SECOND )
		</if>
		
		<if test='@com.dkitec.barocle.util.webutil.StringUtil@isEmpty(searchBgnDe)'>
			AND INFO.COLLECT_DTTM BETWEEN ( LAST_DAY(NOW() - interval 1 MONTH) + INTERVAL 1 DAY ) AND ( LAST_DAY(NOW()) - INTERVAL 1 SECOND )
		</if>
		
		<if test="centerId !='' and centerId !=null">
			AND ADM.ASSIGN_CENTER_ID = #{centerId}
		</if>
		<if test="adminId !='' and adminId !=null">
			AND ADM.ADMIN_ID = #{adminId}
		</if>
		GROUP BY INFO.TAKE_ID, MONTH(INFO.COLLECT_DTTM)
		) A
	</select>



	<select id="getbikeMallReportExcel" parameterType="ManageMallVo" resultType="ManageMallVo">
		SELECT /* 바로클포 월 정비 보고서 */
			#{repairYear} AS repairYear
			,#{repairMonth} AS repairMonth	
			, A.*
		FROM
		(
			SELECT DETL.REPAIR_OURSRC_SEQ
				, INFO.TAKE_ID AS takeId
				, ADM.ADMIN_NAME AS takeName
				, CEN.CENTER_NAME AS centerName
				, CASE WHEN INSTR(CEN.CENTER_NAME, ' ') > -1 THEN SUBSTRING(CEN.CENTER_NAME, 1, INSTR(CEN.CENTER_NAME, ' ')) 
					   ELSE CENTER_NAME
				  END AS centerNo
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_001' THEN 1 ELSE 0 END ) AS rec_001
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_002' THEN 1 ELSE 0 END ) AS rec_002		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_003' THEN 1 ELSE 0 END ) AS rec_003		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_004' THEN 1 ELSE 0 END ) AS rec_004		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_005' THEN 1 ELSE 0 END ) AS rec_005		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_006' THEN 1 ELSE 0 END ) AS rec_006		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_007' THEN 1 ELSE 0 END ) AS rec_007
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_008' THEN 1 ELSE 0 END ) AS rec_008
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_009' THEN 1 ELSE 0 END ) AS rec_009		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_010' THEN 1 ELSE 0 END ) AS rec_010	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_011' THEN 1 ELSE 0 END ) AS rec_011						   
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_012' THEN 1 ELSE 0 END ) AS rec_012						   
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_013' THEN 1 ELSE 0 END ) AS rec_013									
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_014' THEN 1 ELSE 0 END ) AS rec_014									
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_015' THEN 1 ELSE 0 END ) AS rec_015		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_016' THEN 1 ELSE 0 END ) AS rec_016	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_017' THEN 1 ELSE 0 END ) AS rec_017	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_018' THEN 1 ELSE 0 END ) AS rec_018	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_019' THEN 1 ELSE 0 END ) AS rec_019	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_020' THEN 1 ELSE 0 END ) AS rec_020	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_021' THEN 1 ELSE 0 END ) AS rec_021	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_022' THEN 1 ELSE 0 END ) AS rec_022	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_023' THEN 1 ELSE 0 END ) AS rec_023	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_024' THEN 1 ELSE 0 END ) AS rec_024	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_025' THEN 1 ELSE 0 END ) AS rec_025	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_026' THEN 1 ELSE 0 END ) AS rec_026	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_027' THEN 1 ELSE 0 END ) AS rec_027	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_028' THEN 1 ELSE 0 END ) AS rec_028	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_029' THEN 1 ELSE 0 END ) AS rec_029	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_030' THEN 1 ELSE 0 END ) AS rec_030	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_031' THEN 1 ELSE 0 END ) AS rec_031	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_032' THEN 1 ELSE 0 END ) AS rec_032	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_033' THEN 1 ELSE 0 END ) AS rec_033	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_034' THEN 1 ELSE 0 END ) AS rec_034	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_035' THEN 1 ELSE 0 END ) AS rec_035	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_036' THEN 1 ELSE 0 END ) AS rec_036	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_037' THEN 1 ELSE 0 END ) AS rec_037	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_038' THEN 1 ELSE 0 END ) AS rec_038	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_039' THEN 1 ELSE 0 END ) AS rec_039	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_040' THEN 1 ELSE 0 END ) AS rec_040	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_041' THEN 1 ELSE 0 END ) AS rec_041	 
						
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_001' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_001
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_002' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_002		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_003' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_003				  
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_004' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_004		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_005' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_005
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_006' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_006
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_007' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_007
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_008' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_008
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_009' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_009
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_010' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_010
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_011' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_011
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_012' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_012
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_013' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_013
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_014' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_014
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_015' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_015
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_016' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_016
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_017' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_017
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_018' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_018
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_019' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_019
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_020' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_020
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_021' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_021
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_022' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_022
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_023' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_023
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_024' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_024
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_025' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_025
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_026' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_026
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_027' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_027
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_028' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_028
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_029' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_029
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_030' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_030
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_031' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_031
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_032' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_032
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_033' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_033
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_034' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_034
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_035' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_035
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_036' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_036
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_037' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_037
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_038' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_038
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_039' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_039
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_040' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_040
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_041' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_041			
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_001' THEN 0 ELSE 1 END  )					   AS totCnt
				, COUNT( DISTINCT INFO.REPAIR_OURSRC_SEQ) AS bikeCnt	-- TODO 자전거 건수
			FROM TB_MTC_REPAIR_OUTSRC_DETL DETL
				, TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC
				, TB_MTC_REPAIR_OUTSRC_INFO INFO
				, TB_MTC_REPAIR_OUTSRC_MAIN MAIN
				, TB_OPR_CENTER CEN
				, TB_SYS_ADMIN ADM		 
			WHERE 1=1
			AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
			AND PRIC.PRICE_YMD = #{repairYear}
			AND DETL.REPAIR_YN = 'Y'
			AND YEAR(INFO.COLLECT_DTTM) = #{repairYear}
			AND MONTH(INFO.COLLECT_DTTM) = #{repairMonth}
			AND DETL.REPAIR_OURSRC_SEQ = INFO.REPAIR_OURSRC_SEQ
			AND INFO.REPAIR_OUTSRC_MAIN_SEQ = MAIN.REPAIR_OUTSRC_MAIN_SEQ 
			AND INFO.TAKE_ID = #{takeId}	   /*	a1131841767	  */
			AND INFO.TAKE_ID = ADM.ADMIN_ID
			AND ADM.ADMIN_GRP_SEQ = 21
			AND ADM.ASSIGN_CENTER_ID = CEN.CENTER_ID
			   
		)   A  		
		
		
			
	</select>


	<select id="bikeMallReportExcelAdmin" parameterType="ManageMallVo" resultType="ManageMallVo">
		SELECT /* 바로클포 월 정비 보고서 */
			#{repairYear} AS repairYear
			,#{repairMonth} AS repairMonth	
			, A.*
		FROM
		(
			SELECT DETL.REPAIR_OURSRC_SEQ
				, INFO.TAKE_ID AS takeId
				, ADM.ADMIN_NAME AS takeName
				, CEN.CENTER_NAME AS centerName
				, CASE WHEN INSTR(CEN.CENTER_NAME, ' ') > -1 THEN SUBSTRING(CEN.CENTER_NAME, 1, INSTR(CEN.CENTER_NAME, ' ')) 
					   ELSE CENTER_NAME
				  END AS centerNo
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_001' THEN 1 ELSE 0 END ) AS rec_001
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_002' THEN 1 ELSE 0 END ) AS rec_002		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_003' THEN 1 ELSE 0 END ) AS rec_003		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_004' THEN 1 ELSE 0 END ) AS rec_004		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_005' THEN 1 ELSE 0 END ) AS rec_005		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_006' THEN 1 ELSE 0 END ) AS rec_006		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_007' THEN 1 ELSE 0 END ) AS rec_007
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_008' THEN 1 ELSE 0 END ) AS rec_008
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_009' THEN 1 ELSE 0 END ) AS rec_009		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_010' THEN 1 ELSE 0 END ) AS rec_010	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_011' THEN 1 ELSE 0 END ) AS rec_011						   
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_012' THEN 1 ELSE 0 END ) AS rec_012						   
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_013' THEN 1 ELSE 0 END ) AS rec_013									
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_014' THEN 1 ELSE 0 END ) AS rec_014									
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_015' THEN 1 ELSE 0 END ) AS rec_015		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_016' THEN 1 ELSE 0 END ) AS rec_016	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_017' THEN 1 ELSE 0 END ) AS rec_017	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_018' THEN 1 ELSE 0 END ) AS rec_018	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_019' THEN 1 ELSE 0 END ) AS rec_019	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_020' THEN 1 ELSE 0 END ) AS rec_020	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_021' THEN 1 ELSE 0 END ) AS rec_021	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_022' THEN 1 ELSE 0 END ) AS rec_022	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_023' THEN 1 ELSE 0 END ) AS rec_023	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_024' THEN 1 ELSE 0 END ) AS rec_024	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_025' THEN 1 ELSE 0 END ) AS rec_025	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_026' THEN 1 ELSE 0 END ) AS rec_026	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_027' THEN 1 ELSE 0 END ) AS rec_027	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_028' THEN 1 ELSE 0 END ) AS rec_028	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_029' THEN 1 ELSE 0 END ) AS rec_029	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_030' THEN 1 ELSE 0 END ) AS rec_030	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_031' THEN 1 ELSE 0 END ) AS rec_031	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_032' THEN 1 ELSE 0 END ) AS rec_032	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_033' THEN 1 ELSE 0 END ) AS rec_033	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_034' THEN 1 ELSE 0 END ) AS rec_034	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_035' THEN 1 ELSE 0 END ) AS rec_035	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_036' THEN 1 ELSE 0 END ) AS rec_036	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_037' THEN 1 ELSE 0 END ) AS rec_037	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_038' THEN 1 ELSE 0 END ) AS rec_038	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_039' THEN 1 ELSE 0 END ) AS rec_039	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_040' THEN 1 ELSE 0 END ) AS rec_040	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_041' THEN 1 ELSE 0 END ) AS rec_041	 
				, SUM( PRIC.PRICE*DISCOUNT_RATE  )							   AS totAmt 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_001' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_001
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_002' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_002		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_003' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_003				  
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_004' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_004		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_005' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_005
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_006' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_006
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_007' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_007
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_008' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_008
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_009' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_009
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_010' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_010
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_011' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_011
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_012' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_012
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_013' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_013
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_014' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_014
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_015' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_015
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_016' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_016
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_017' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_017
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_018' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_018
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_019' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_019
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_020' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_020
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_021' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_021
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_022' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_022
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_023' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_023
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_024' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_024
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_025' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_025
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_026' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_026
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_027' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_027
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_028' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_028
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_029' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_029
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_030' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_030
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_031' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_031
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_032' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_032
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_033' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_033
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_034' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_034
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_035' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_035
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_036' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_036
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_037' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_037
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_038' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_038
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_039' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_039
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_040' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_040
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_041' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_041			
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_001' THEN 0 ELSE 1 END  )					   AS totCnt  -- 20210419 기본점검은 건수에서 제외
				, COUNT( DISTINCT INFO.REPAIR_OURSRC_SEQ) AS bikeCnt	-- TODO 자전거 건수
			FROM TB_MTC_REPAIR_OUTSRC_DETL DETL
				, TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC
				, TB_MTC_REPAIR_OUTSRC_INFO INFO
				, TB_MTC_REPAIR_OUTSRC_MAIN MAIN
				, TB_OPR_CENTER CEN
				, TB_SYS_ADMIN ADM		 
			WHERE 1=1
			AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
			AND DETL.REPAIR_YN = 'Y'
			
		<if test="searchBgnDe == '' ">
			AND PRIC.PRICE_YMD = DATE_FORMAT(NOW(),'%Y')
			AND INFO.COLLECT_DTTM BETWEEN ( LAST_DAY(NOW() - interval 1 MONTH) + INTERVAL 1 DAY ) AND ( LAST_DAY(NOW()) - INTERVAL 1 SECOND )
		</if> 
		
		<if test="searchBgnDe!='' and searchBgnDe!=null">
			AND PRIC.PRICE_YMD = DATE_FORMAT(NOW(),'%Y')
			AND INFO.COLLECT_DTTM BETWEEN ( LAST_DAY( STR_TO_DATE(#{searchBgnDe}, '%Y-%m-%d') - interval 1 MONTH) + INTERVAL 1 DAY ) AND ( LAST_DAY( STR_TO_DATE(#{searchBgnDe}, '%Y-%m-%d') ) + INTERVAL 1 DAY - INTERVAL 1 SECOND )
		</if>
			
			AND DETL.REPAIR_OURSRC_SEQ = INFO.REPAIR_OURSRC_SEQ
			AND INFO.REPAIR_OUTSRC_MAIN_SEQ = MAIN.REPAIR_OUTSRC_MAIN_SEQ 
			AND INFO.TAKE_ID = ADM.ADMIN_ID
			AND ADM.ADMIN_GRP_SEQ = 21
			AND ADM.ASSIGN_CENTER_ID = CEN.CENTER_ID
		   group BY CEN.CENTER_NAME	
		)   A  		
	</select>
	
	<select id="bikeMallReportBikeExcel" parameterType="ManageMallVo" resultType="ManageMallVo">
		SELECT /* 바로클포 월 정비 보고서 */
			#{repairYear} AS repairYear
			,#{repairMonth} AS repairMonth	
			, A.*
		FROM
		(
			SELECT DETL.REPAIR_OURSRC_SEQ
				  , concat( MONTH(INFO.REG_DTTM) ,'월 ' , DAY(INFO.REG_DTTM) ,'일 ' , HOUR(INFO.REG_DTTM) , '시' )  AS regDttm
				  , concat( MONTH(TRANS_DTTM   ) ,'월 ' , DAY(TRANS_DTTM   ) ,'일 ' , HOUR(TRANS_DTTM   ) , '시' )  AS transDttm
				  , concat( MONTH(TAKE_DTTM	) ,'월 ' , DAY(TAKE_DTTM	) ,'일 ' , HOUR(TAKE_DTTM	) , '시' )  AS takeDttm
				  , concat( MONTH(COLLECT_DTTM ) ,'월 ' , DAY(COLLECT_DTTM ) ,'일 ' , HOUR(COLLECT_DTTM ) , '시' )  AS collectDttm
			
				, INFO.TAKE_ID AS takeId
				, ADM.ADMIN_NAME AS takeName
				, CEN.CENTER_NAME AS centerName
				, BIKE.BIKE_NO AS centerNo
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_001' THEN 1 ELSE 0 END ) AS rec_001
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_002' THEN 1 ELSE 0 END ) AS rec_002		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_003' THEN 1 ELSE 0 END ) AS rec_003		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_004' THEN 1 ELSE 0 END ) AS rec_004		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_005' THEN 1 ELSE 0 END ) AS rec_005		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_006' THEN 1 ELSE 0 END ) AS rec_006		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_007' THEN 1 ELSE 0 END ) AS rec_007
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_008' THEN 1 ELSE 0 END ) AS rec_008
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_009' THEN 1 ELSE 0 END ) AS rec_009		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_010' THEN 1 ELSE 0 END ) AS rec_010	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_011' THEN 1 ELSE 0 END ) AS rec_011						   
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_012' THEN 1 ELSE 0 END ) AS rec_012						   
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_013' THEN 1 ELSE 0 END ) AS rec_013									
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_014' THEN 1 ELSE 0 END ) AS rec_014									
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_015' THEN 1 ELSE 0 END ) AS rec_015		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_016' THEN 1 ELSE 0 END ) AS rec_016	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_017' THEN 1 ELSE 0 END ) AS rec_017	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_018' THEN 1 ELSE 0 END ) AS rec_018	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_019' THEN 1 ELSE 0 END ) AS rec_019	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_020' THEN 1 ELSE 0 END ) AS rec_020	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_021' THEN 1 ELSE 0 END ) AS rec_021	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_022' THEN 1 ELSE 0 END ) AS rec_022	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_023' THEN 1 ELSE 0 END ) AS rec_023	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_024' THEN 1 ELSE 0 END ) AS rec_024	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_025' THEN 1 ELSE 0 END ) AS rec_025	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_026' THEN 1 ELSE 0 END ) AS rec_026	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_027' THEN 1 ELSE 0 END ) AS rec_027	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_028' THEN 1 ELSE 0 END ) AS rec_028	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_029' THEN 1 ELSE 0 END ) AS rec_029	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_030' THEN 1 ELSE 0 END ) AS rec_030	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_031' THEN 1 ELSE 0 END ) AS rec_031	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_032' THEN 1 ELSE 0 END ) AS rec_032	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_033' THEN 1 ELSE 0 END ) AS rec_033	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_034' THEN 1 ELSE 0 END ) AS rec_034	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_035' THEN 1 ELSE 0 END ) AS rec_035	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_036' THEN 1 ELSE 0 END ) AS rec_036	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_037' THEN 1 ELSE 0 END ) AS rec_037	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_038' THEN 1 ELSE 0 END ) AS rec_038	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_039' THEN 1 ELSE 0 END ) AS rec_039	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_040' THEN 1 ELSE 0 END ) AS rec_040	 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_041' THEN 1 ELSE 0 END ) AS rec_041	 
				, SUM( PRIC.PRICE*DISCOUNT_RATE  )							   AS totAmt 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_001' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_001
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_002' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_002		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_003' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_003				  
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_004' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_004		 
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_005' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_005
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_006' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_006
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_007' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_007
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_008' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_008
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_009' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_009
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_010' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_010
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_011' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_011
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_012' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_012
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_013' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_013
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_014' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_014
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_015' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_015
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_016' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_016
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_017' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_017
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_018' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_018
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_019' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_019
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_020' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_020
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_021' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_021
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_022' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_022
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_023' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_023
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_024' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_024
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_025' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_025
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_026' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_026
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_027' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_027
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_028' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_028
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_029' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_029
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_030' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_030
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_031' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_031
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_032' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_032
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_033' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_033
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_034' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_034
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_035' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_035
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_036' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_036
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_037' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_037
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_038' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_038
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_039' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_039
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_040' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_040
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_041' THEN PRIC.PRICE*DISCOUNT_RATE ELSE 0 END ) AS price_041			
				, SUM( CASE WHEN BRKDN_STUS_CD  ='REC_001' THEN 0 ELSE 1 END  )					   AS totCnt  -- 20210419 기본점검은 건수에서 제외
				, COUNT( DISTINCT INFO.REPAIR_OURSRC_SEQ) AS bikeCnt	-- TODO 자전거 건수
				
			FROM TB_MTC_REPAIR_OUTSRC_DETL DETL
				, TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC
				, TB_MTC_REPAIR_OUTSRC_INFO INFO
				, TB_MTC_REPAIR_OUTSRC_MAIN MAIN
				, TB_OPR_CENTER CEN
				, TB_SYS_ADMIN ADM		 
				, TB_OPR_BIKE BIKE
			WHERE 1=1
			AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
			AND PRIC.PRICE_YMD = #{repairYear}
			AND DETL.REPAIR_YN = 'Y'
			AND YEAR(INFO.COLLECT_DTTM) = #{repairYear}
			AND MONTH(INFO.COLLECT_DTTM) = #{repairMonth}
			 
			AND INFO.TAKE_ID = #{takeId}
			
			
			AND DETL.REPAIR_OURSRC_SEQ = INFO.REPAIR_OURSRC_SEQ
			AND INFO.REPAIR_OUTSRC_MAIN_SEQ = MAIN.REPAIR_OUTSRC_MAIN_SEQ 
			AND INFO.TAKE_ID = ADM.ADMIN_ID
			AND ADM.ADMIN_GRP_SEQ = 21
			AND ADM.ASSIGN_CENTER_ID = CEN.CENTER_ID
			
			AND INFO.EQUIPMENT_ID = BIKE.BIKE_ID
			
		   group BY INFO.REPAIR_OURSRC_SEQ   
		)   A  		
	</select>
	
	<select id="getbikeMallReportExcel_OLD" parameterType="ManageMallVo" resultType="ManageMallVo">
		SELECT /* 바로클포 월 정비 보고서 */
		
		
		INFO.TAKE_ID AS takeId
		, ADM.ADMIN_NAME AS takeName
		, CEN.CENTER_NAME AS centerName
		, CASE WHEN INSTR(CEN.CENTER_NAME, ' ') > -1 THEN SUBSTRING(CEN.CENTER_NAME, 1, INSTR(CEN.CENTER_NAME, ' ')) 
			   ELSE CENTER_NAME
		  END AS centerNo
		,#{repairYear} AS repairYear
		,#{repairMonth} AS repairMonth
		
		/*
		, (SELECT COUNT(A.EQUIPMENT_ID) FROM TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_INFO A
			WHERE DETL.REPAIR_YN = 'Y'
			AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
			AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
			AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
			AND DETL.REPAIR_OURSRC_SEQ = INFO.REPAIR_OURSRC_SEQ
			AND A.TAKE_ID = #{takeId}
			GROUP BY INFO.EQUIPMENT_ID
		) AS bikeCnt
		
		, COUNT(REC_001.BRKDN_STUS_CD) AS 'rec_001', IFNULL(SUM(REC_001.PRICE),0) AS 'price_001'
		, COUNT(REC_002.BRKDN_STUS_CD) AS 'rec_002', IFNULL(SUM(REC_002.PRICE),0) AS 'price_002'
		, COUNT(REC_003.BRKDN_STUS_CD) AS 'rec_003', IFNULL(SUM(REC_003.PRICE),0) AS 'price_003'
		, COUNT(REC_004.BRKDN_STUS_CD) AS 'rec_004', IFNULL(SUM(REC_004.PRICE),0) AS 'price_004'
		, COUNT(REC_005.BRKDN_STUS_CD) AS 'rec_005', IFNULL(SUM(REC_005.PRICE),0) AS 'price_005'
		, COUNT(REC_006.BRKDN_STUS_CD) AS 'rec_006', IFNULL(SUM(REC_006.PRICE),0) AS 'price_006'
		, COUNT(REC_007.BRKDN_STUS_CD) AS 'rec_007', IFNULL(SUM(REC_007.PRICE),0) AS 'price_007'
		, COUNT(REC_008.BRKDN_STUS_CD) AS 'rec_008', IFNULL(SUM(REC_008.PRICE),0) AS 'price_008'
		, COUNT(REC_009.BRKDN_STUS_CD) AS 'rec_009', IFNULL(SUM(REC_009.PRICE),0) AS 'price_009'
		, COUNT(REC_010.BRKDN_STUS_CD) AS 'rec_010', IFNULL(SUM(REC_010.PRICE),0) AS 'price_010'
		, COUNT(REC_011.BRKDN_STUS_CD) AS 'rec_011', IFNULL(SUM(REC_011.PRICE),0) AS 'price_011'
		, COUNT(REC_012.BRKDN_STUS_CD) AS 'rec_012', IFNULL(SUM(REC_012.PRICE),0) AS 'price_012'
		, COUNT(REC_013.BRKDN_STUS_CD) AS 'rec_013', IFNULL(SUM(REC_013.PRICE),0) AS 'price_013'
		, COUNT(REC_014.BRKDN_STUS_CD) AS 'rec_014', IFNULL(SUM(REC_014.PRICE),0) AS 'price_014'
		, COUNT(REC_015.BRKDN_STUS_CD) AS 'rec_015', IFNULL(SUM(REC_015.PRICE),0) AS 'price_015'
		, COUNT(REC_016.BRKDN_STUS_CD) AS 'rec_016', IFNULL(SUM(REC_016.PRICE),0) AS 'price_016'
		, COUNT(REC_017.BRKDN_STUS_CD) AS 'rec_017', IFNULL(SUM(REC_017.PRICE),0) AS 'price_017'
		, COUNT(REC_018.BRKDN_STUS_CD) AS 'rec_018', IFNULL(SUM(REC_018.PRICE),0) AS 'price_018'
		, COUNT(REC_019.BRKDN_STUS_CD) AS 'rec_019', IFNULL(SUM(REC_019.PRICE),0) AS 'price_019'
		, COUNT(REC_020.BRKDN_STUS_CD) AS 'rec_020', IFNULL(SUM(REC_020.PRICE),0) AS 'price_020'

		, COUNT(REC_021.BRKDN_STUS_CD) AS 'rec_021', IFNULL(SUM(REC_021.PRICE),0) AS 'price_021'
		, COUNT(REC_022.BRKDN_STUS_CD) AS 'rec_022', IFNULL(SUM(REC_022.PRICE),0) AS 'price_022'
		, COUNT(REC_023.BRKDN_STUS_CD) AS 'rec_023', IFNULL(SUM(REC_023.PRICE),0) AS 'price_023'
		, COUNT(REC_024.BRKDN_STUS_CD) AS 'rec_024', IFNULL(SUM(REC_024.PRICE),0) AS 'price_024'
		, COUNT(REC_025.BRKDN_STUS_CD) AS 'rec_025', IFNULL(SUM(REC_025.PRICE),0) AS 'price_025'
		, COUNT(REC_026.BRKDN_STUS_CD) AS 'rec_026', IFNULL(SUM(REC_026.PRICE),0) AS 'price_026'
		, COUNT(REC_027.BRKDN_STUS_CD) AS 'rec_027', IFNULL(SUM(REC_027.PRICE),0) AS 'price_027'
		, COUNT(REC_028.BRKDN_STUS_CD) AS 'rec_028', IFNULL(SUM(REC_028.PRICE),0) AS 'price_028'
		, COUNT(REC_029.BRKDN_STUS_CD) AS 'rec_029', IFNULL(SUM(REC_029.PRICE),0) AS 'price_029'
		
		, COUNT(REC_030.BRKDN_STUS_CD) AS 'rec_030', IFNULL(SUM(REC_030.PRICE),0) AS 'price_030'
		, COUNT(REC_031.BRKDN_STUS_CD) AS 'rec_031', IFNULL(SUM(REC_031.PRICE),0) AS 'price_031'
		, COUNT(REC_032.BRKDN_STUS_CD) AS 'rec_032', IFNULL(SUM(REC_032.PRICE),0) AS 'price_032'
		, COUNT(REC_033.BRKDN_STUS_CD) AS 'rec_033', IFNULL(SUM(REC_033.PRICE),0) AS 'price_033'
		, COUNT(REC_034.BRKDN_STUS_CD) AS 'rec_034', IFNULL(SUM(REC_034.PRICE),0) AS 'price_034'
		, COUNT(REC_035.BRKDN_STUS_CD) AS 'rec_035', IFNULL(SUM(REC_035.PRICE),0) AS 'price_035'
		, COUNT(REC_036.BRKDN_STUS_CD) AS 'rec_036', IFNULL(SUM(REC_036.PRICE),0) AS 'price_036'
		, COUNT(REC_037.BRKDN_STUS_CD) AS 'rec_037', IFNULL(SUM(REC_037.PRICE),0) AS 'price_037'
		, COUNT(REC_038.BRKDN_STUS_CD) AS 'rec_038', IFNULL(SUM(REC_038.PRICE),0) AS 'price_038'
		, COUNT(REC_039.BRKDN_STUS_CD) AS 'rec_039', IFNULL(SUM(REC_039.PRICE),0) AS 'price_039'
		
		, COUNT(REC_040.BRKDN_STUS_CD) AS 'rec_040', IFNULL(SUM(REC_040.PRICE),0) AS 'price_040'
		, COUNT(REC_041.BRKDN_STUS_CD) AS 'rec_041', IFNULL(SUM(REC_041.PRICE),0) AS 'price_041'
		
		FROM
		TB_MTC_REPAIR_OUTSRC_INFO INFO

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_001'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND DETL.REPAIR_YN = 'Y'
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_001
		ON INFO.REPAIR_OURSRC_SEQ = REC_001.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_002'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_002
		ON INFO.REPAIR_OURSRC_SEQ = REC_002.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_003'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_003
		ON INFO.REPAIR_OURSRC_SEQ = REC_003.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_004'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_004
		ON INFO.REPAIR_OURSRC_SEQ = REC_004.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_005'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_005
		ON INFO.REPAIR_OURSRC_SEQ = REC_005.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_006'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_006
		ON INFO.REPAIR_OURSRC_SEQ = REC_006.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_007'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_007
		ON INFO.REPAIR_OURSRC_SEQ = REC_007.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_008'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_008
		ON INFO.REPAIR_OURSRC_SEQ = REC_008.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_009'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_009
		ON INFO.REPAIR_OURSRC_SEQ = REC_009.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_010'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_010
		ON INFO.REPAIR_OURSRC_SEQ = REC_010.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_011'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_011
		ON INFO.REPAIR_OURSRC_SEQ = REC_011.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_012'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_012
		ON INFO.REPAIR_OURSRC_SEQ = REC_012.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_013'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_013
		ON INFO.REPAIR_OURSRC_SEQ = REC_013.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_014'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_014
		ON INFO.REPAIR_OURSRC_SEQ = REC_014.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_015'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_015
		ON INFO.REPAIR_OURSRC_SEQ = REC_015.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_016'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_016
		ON INFO.REPAIR_OURSRC_SEQ = REC_016.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_017'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_017
		ON INFO.REPAIR_OURSRC_SEQ = REC_017.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_018'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_018
		ON INFO.REPAIR_OURSRC_SEQ = REC_018.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_019'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_019
		ON INFO.REPAIR_OURSRC_SEQ = REC_019.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_020'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_020
		ON INFO.REPAIR_OURSRC_SEQ = REC_020.REPAIR_OURSRC_SEQ
		
		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_021'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_021
		ON INFO.REPAIR_OURSRC_SEQ = REC_021.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_022'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_022
		ON INFO.REPAIR_OURSRC_SEQ = REC_022.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_023'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_023
		ON INFO.REPAIR_OURSRC_SEQ = REC_023.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_024'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_024
		ON INFO.REPAIR_OURSRC_SEQ = REC_024.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_025'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_025
		ON INFO.REPAIR_OURSRC_SEQ = REC_025.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_026'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_026
		ON INFO.REPAIR_OURSRC_SEQ = REC_026.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_027'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_027
		ON INFO.REPAIR_OURSRC_SEQ = REC_027.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_028'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_028
		ON INFO.REPAIR_OURSRC_SEQ = REC_028.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_029'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_029
		ON INFO.REPAIR_OURSRC_SEQ = REC_029.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_030'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_030
		ON INFO.REPAIR_OURSRC_SEQ = REC_030.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_031'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_031
		ON INFO.REPAIR_OURSRC_SEQ = REC_031.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_032'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_032
		ON INFO.REPAIR_OURSRC_SEQ = REC_032.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_033'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_033
		ON INFO.REPAIR_OURSRC_SEQ = REC_033.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_034'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_034
		ON INFO.REPAIR_OURSRC_SEQ = REC_034.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_035'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_035
		ON INFO.REPAIR_OURSRC_SEQ = REC_035.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_036'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_036
		ON INFO.REPAIR_OURSRC_SEQ = REC_036.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_037'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_037
		ON INFO.REPAIR_OURSRC_SEQ = REC_037.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_038'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_038
		ON INFO.REPAIR_OURSRC_SEQ = REC_038.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_039'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_039
		ON INFO.REPAIR_OURSRC_SEQ = REC_039.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_040'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_040
		ON INFO.REPAIR_OURSRC_SEQ = REC_040.REPAIR_OURSRC_SEQ

		LEFT JOIN (SELECT DETL.REPAIR_OURSRC_SEQ,BRKDN_STUS_CD,PRIC.PRICE FROM
		TB_MTC_REPAIR_OUTSRC_DETL DETL,TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC, TB_MTC_REPAIR_OUTSRC_INFO A
		WHERE BRKDN_STUS_CD = 'REC_041'
		AND DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND PRIC.PRICE_YMD = YEAR(DETL.REPAIR_DTTM)
		AND YEAR(DETL.REPAIR_DTTM) = #{repairYear}
		AND MONTH(DETL.REPAIR_DTTM) = #{repairMonth}
		AND DETL.REPAIR_OURSRC_SEQ = A.REPAIR_OURSRC_SEQ
		AND A.TAKE_ID = #{takeId}) REC_041
		ON INFO.REPAIR_OURSRC_SEQ = REC_041.REPAIR_OURSRC_SEQ

		,TB_OPR_CENTER CEN
		,TB_SYS_ADMIN ADM
		WHERE INFO.READ_CLS_CD = 'H'
		AND INFO.TAKE_ID = #{takeId}
		AND ADM.ASSIGN_CENTER_ID = CEN.CENTER_ID
		AND INFO.TAKE_ID = ADM.ADMIN_ID
		AND ADM.ADMIN_GRP_SEQ = 21
		GROUP BY INFO.TAKE_ID
	</select>
	
<!-- 	<select id="getbikeMallReportExcel" parameterType="ManageMallVo"
		resultType="ManageMallVo">
	SELECT /* 바로클포 월 정비 보고서 */
		TAKE_ID AS takeId
		, ADMIN_NAME AS takeName
		, CENTER_NAME AS centerName
		, '2020' AS repairYear
		, '7' AS repairMonth
		, COUNT(BRKDN_STUS_CD) AS cnt
		, BRKDN_STUS_CD AS cd 
		, PRIC.PRICE AS price
		FROM TB_MTC_REPAIR_OUTSRC_INFO INFO
		   , TB_MTC_REPAIR_OUTSRC_DETL DETL
		   , TB_MTC_REPAIR_OUTSRC_PRICE_HIST PRIC
		   , TB_OPR_CENTER CEN
		   , TB_SYS_ADMIN ADM
		WHERE DETL.BRKDN_STUS_CD = PRIC.COM_CD
		AND REPAIR_YN = 'Y'
		AND INFO.REPAIR_OURSRC_SEQ = DETL.REPAIR_OURSRC_SEQ
		AND PRIC.PRICE_YMD = #{repairYear}
		AND MONTH(REPAIR_DTTM) = #{repairMonth}
		AND READ_CLS_CD = 'H'
		AND TAKE_ID = #{takeId}
		AND ADM.ASSIGN_CENTER_ID = CEN.CENTER_ID
		AND INFO.TAKE_ID = ADM.ADMIN_ID
		AND ADMIN_GRP_SEQ = 21
		GROUP BY BRKDN_STUS_CD
		
	</select> -->

	<insert id="addRepMonthSmsHist" parameterType="ManageMallVo">
		INSERT INTO TB_MTC_REPAIR_NOTICE( /* 수리내역통보 이력 저장 */
		ADMIN_ID
		, CENTER_ID
		, PARTS_REPAIR_NUM
		, BIKE_REPAIR_NUM
		, REPAIR_PRICE
		, MONTHS
		, SEND_DTTM
		)
		VALUES (
		#{adminId}
		, (SELECT ASSIGN_CENTER_ID FROM TB_SYS_ADMIN WHERE ADMIN_ID=#{adminId})
		<!-- , #{centerId} -->
		, #{partsRepairNum}
		, #{bikeRepairNum}
		, #{repairPrice}
		, #{months}
		, NOW()
		)
	</insert>

</mapper>